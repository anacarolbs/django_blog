{% extends "base.html" %}
<!-- Carrega os filtros personalizados definidos no arquivo blog_filters.py -->
{% load blog_filters %}

{% block page_title %}
    <h2 class="page-title"> Blog Posts</h2>
{% endblock page_title %}

{% block page_content %}
<!-- Container para exibir os posts -->
    <div class="posts-container">
        <!-- Loop que percorre a lista de posts passada pelo contexto da view -->
        {% for post in posts %}
        <!-- Cada post Ã© exibido dentro de um "cartÃ£o" -->
            <div class="post-card">

                <!-- Filtro 1: Truncar o tÃ­tulo -->
                 <!-- Exibe o tÃ­tulo do post truncado em atÃ© 50 caracteres -->
                <h3><a href="{% url 'blog_detail' post.pk %}" class="post-title">{{ post.title|truncate_chars:50 }}</a></h3>

                <!-- Filtro 2: Formatar a data -->
                <div class="post-meta">
                    <!-- Exibe a data de criaÃ§Ã£o formatada e as categorias do post -->
                    <small>ðŸ“… {{ post.created_on|format_date }} | ðŸ“‚ Categorias:</small>
                    <p>
                        <!-- Filtro 3: Converter categorias para maiÃºsculas -->
                        {% for category in post.categories.all %}
                            <span class="category-btn">
                                <!-- Exibe o nome da categoria em letras maiÃºsculas -->
                                <a href="{% url 'blog_category' category.name %}">{{ category.name|to_uppercase }}</a>
                            </span>
                        {% endfor %}
                    </p>
                </div>                

                <!-- Exibe o corpo do post truncado em atÃ© 400 caracteres -->
                <p class="post-content">{{ post.body|truncate_chars:400 }}</p>

                <!-- Exibe as reaÃ§Ãµes ao post -->
                <div class="post-extras">
                    <p><strong> ReaÃ§Ãµes:</strong> 
                        {% if post.reactions.all %}
                            {% for reaction in post.reactions.all %}
                            <!-- Exibe o tipo de reaÃ§Ã£o -->
                                <span class="reaction">{{ reaction.reaction_type }}</span>
                            {% endfor %}
                        {% else %}
                        <!-- Mensagem exibida se nÃ£o houver reaÃ§Ãµes -->
                            <span class="no-reaction">Nenhuma reaÃ§Ã£o ainda.</span>
                        {% endif %}
                    </p>
                </div>
                

                <p><strong> AvaliaÃ§Ã£o:</strong> MÃ©dia de 
                    {% if post.ratings.count > 0 %}
                    <!-- Exibe a mÃ©dia de avaliaÃ§Ãµes se houver -->
                        <span class="rating">{{ post.ratings.aggregate_avg }} estrelas</span>
                    {% else %}
                    <!-- Mensagem exibida se nÃ£o houver avaliaÃ§Ãµes -->
                        <span class="no-rating">Ainda sem avaliaÃ§Ãµes.</span>
                    {% endif %}
                </p>

                <!-- Link para a pÃ¡gina de sugestÃµes de post -->
                <p class="suggestion-link">
                    <a href="{% url 'blog_suggestions' %}" class="btn-suggestions"> Ver sugestÃµes de post</a>
                </p>
            </div>
        {% endfor %}
    </div>
{% endblock page_content %}